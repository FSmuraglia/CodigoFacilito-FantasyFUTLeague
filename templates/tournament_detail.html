<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle del Torneo - {{ .tournament.Name }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark px-4">
    <a class="navbar-brand fw-bold" href="/">FantasyFUTLeague</a>

    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link" href="/tournaments">Torneos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/teams">Equipos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/players">Jugadores</a>
        </li>
      </ul>

      <!-- Enlaces seg√∫n sesi√≥n -->
      <ul class="navbar-nav ms-auto">
        {{ if .IsLoggedIn }}
          <li class="nav-item">
            <a class="nav-link text-danger" href="/profile">Perfil</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-danger" href="/logout">Cerrar sesi√≥n</a>
          </li>
        {{ else }}
          <li class="nav-item">
            <a class="nav-link" href="/login">Iniciar sesi√≥n</a>
          </li>
        {{ end }}
      </ul>
    </div>
  </nav>
  <div class="container mt-5">
    <h2 class="text-center mb-4">{{ .tournament.Name }}</h2>

    <!-- Info general -->
    <div class="card mb-4">
      <div class="card-body">
        <p><strong>Premio:</strong> ‚Ç¨{{ .tournament.FormattedPrize }}</p>
        <p><strong>Fecha de inicio:</strong> {{ .tournament.StartDate.Format "02/01/2006" }}</p>
        <p><strong>Fecha de finalizaci√≥n:</strong>
          {{ if .tournament.EndDate.IsZero }} A√∫n no definida {{ else }} {{ .tournament.EndDate.Format "02/01/2006" }} {{ end }}
        </p>
        <p><strong>Ganador:</strong>
          {{ if .tournament.Winner.Name }} {{ .tournament.Winner.Name }} {{ else }} A determinar {{ end }}
        </p>
        <p><strong>Cantidad de equipos:</strong> {{ .tournament.TeamAmount }}</p>
      </div>
    </div>

    <!-- Equipos inscriptos -->
    <h4>Equipos Inscriptos</h4>
    {{ if .tournament.Teams }}
      <ul class="list-group mb-4">
        {{ range .tournament.Teams }}
          <li class="list-group-item d-flex align-items-center">
            <img src="{{ .Team.BadgeUrl }}" alt="Escudo" style="width:40px;height:40px;border-radius:6px;margin-right:10px;">
            {{ .Team.Name }}
          </li>
        {{ end }}
      </ul>
    {{ else }}
      <p class="text-muted">No hay equipos inscriptos.</p>
    {{ end }}

    <!-- Bracket -->
    <h4>Cuadro del Torneo</h4>
    <div class="bracket my-4 p-3 border rounded bg-white">
      {{ if eq .tournament.TeamAmount 2 }}
        <div class="text-center">
          <h5>Final</h5>
          <div class="d-flex justify-content-center align-items-center gap-3 mt-3">
            {{ if .tournament.Teams }}
              {{ range .tournament.Teams }}
                <div class="border p-2 rounded text-center" style="min-width:120px;">
                  {{ .Team.Name }}
                </div>
              {{ end }}
            {{ else }}
              <p class="text-muted">Esperando equipos...</p>
            {{ end }}
          </div>
        </div>
      {{ else if eq .tournament.TeamAmount 4 }}
        <div class="text-center">
          <h5>Semifinales</h5>
          <div class="d-flex justify-content-center align-items-center gap-3 mt-3">
            <div class="border p-2 rounded">Equipo 1</div>
            <div class="border p-2 rounded">Equipo 2</div>
            <span class="mx-4">‚Üí</span>
            <div class="border p-2 rounded">Ganador A</div>
          </div>
          <div class="d-flex justify-content-center align-items-center gap-3 mt-3">
            <div class="border p-2 rounded">Equipo 3</div>
            <div class="border p-2 rounded">Equipo 4</div>
            <span class="mx-4">‚Üí</span>
            <div class="border p-2 rounded">Ganador B</div>
          </div>
          <h5 class="mt-4">Final</h5>
          <div class="d-flex justify-content-center align-items-center gap-3 mt-3">
            <div class="border p-2 rounded">Ganador A</div>
            <span class="mx-4">vs</span>
            <div class="border p-2 rounded">Ganador B</div>
          </div>
        </div>
      {{ end }}
    </div>

    <!-- Botones -->
<div class="text-center mt-4">
  {{ if .isAdmin }}
    <!-- El bot√≥n de admin no se toca -->
    <a href="/tournaments/{{ .tournament.ID }}/edit" class="btn btn-warning">Modificar Torneo</a>

  {{ else if .isFull }}
    <!-- Torneo lleno -->
    <div class="alert alert-secondary" role="alert">
      üèÜ Torneo completo, no se admiten m√°s inscripciones.
    </div>

  {{ else if .isRegistered }}
    <!-- Usuario ya inscripto -->
    <div class="alert alert-info" role="alert">
      ‚úÖ Ya est√°s inscripto a este torneo.
    </div>

  {{ else if .IsLoggedIn }}
    <!-- Usuario logueado, puede inscribirse -->
    <form method="POST" action="/tournaments/{{ .tournament.ID }}/join">
      <button class="btn btn-primary">Inscribirse al Torneo</button>
    </form>

  {{ else }}
    <!-- Usuario no autenticado -->
    <div class="alert alert-warning" role="alert">
      üîí Inici√° sesi√≥n para inscribirte al torneo.
    </div>
  {{ end }}
</div>
  </div>
</body>
</html>