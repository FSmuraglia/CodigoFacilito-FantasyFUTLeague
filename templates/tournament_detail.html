<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle del Torneo - {{ .tournament.Name }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark px-4">
    <a class="navbar-brand fw-bold" href="/">FantasyFUTLeague</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          {{ if .IsLoggedIn }}
          <li class="nav-item">
            <a class="nav-link" href="/tournaments">Torneos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teams">Equipos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/players">Jugadores</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/matches">Partidos</a>
          </li>
        </ul>
        <!-- Enlaces seg√∫n sesi√≥n -->
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link text-danger" href="/profile">Perfil</a>
          </li>
          <li class="nav-item">
            <a class="nav-link text-danger" href="/logout">Cerrar sesi√≥n</a>
          </li>
      {{ else }}
          <li class="nav-item">
            <a class="nav-link" href="/login">Iniciar sesi√≥n</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/register">Registrarse</a>
          </li>
      {{ end }}
          </ul>
    </div>
  </nav>
  <div class="container mt-5">
    <h2 class="text-center mb-4">{{ .tournament.Name }}</h2>

    <!-- Info general -->
    <div class="card mb-4">
      <div class="card-body">
        <p><strong>Premio:</strong> ‚Ç¨{{ .tournament.FormattedPrize }}</p>
        <p><strong>Fecha de inicio:</strong> {{ .tournament.StartDate.Format "02/01/2006" }}</p>
        <p><strong>Fecha de finalizaci√≥n:</strong>
          {{ if .tournament.EndDate.IsZero }} A√∫n no definida {{ else }} {{ .tournament.EndDate.Format "02/01/2006" }} {{ end }}
        </p>
        <p><strong>Ganador:</strong>
          {{ if .tournament.Winner.Name }} {{ .tournament.Winner.Name }} {{ else }} A determinar {{ end }}
        </p>
        <p><strong>Cantidad de equipos:</strong> {{ .tournament.TeamAmount }}</p>
      </div>
    </div>

    <!-- Equipos inscriptos -->
    <h4>Equipos Inscriptos</h4>
    {{ if .tournament.Teams }}
      <ul class="list-group mb-4">
        {{ range .tournament.Teams }}
          <li class="list-group-item d-flex align-items-center">
            <img src="{{ .Team.BadgeUrl }}" alt="Escudo" style="width:40px;height:40px;border-radius:6px;margin-right:10px;">
            {{ .Team.Name }}
          </li>
        {{ end }}
      </ul>
    {{ else }}
      <p class="text-muted">No hay equipos inscriptos.</p>
    {{ end }}

    <!-- Cuadro del torneo o tabla de posiciones -->
    <div class="bracket my-4 p-3 border rounded bg-white">
      {{ if eq .tournament.TeamAmount 2 }}
        <h4>Cuadro del Torneo</h4>
        <div class="text-center">
          <h5>Final</h5>
          <div class="d-flex justify-content-center align-items-center gap-3 mt-3">
            {{ if .tournament.Teams }}
              {{ range .tournament.Teams }}
                <div class="border p-2 rounded text-center" style="min-width:120px;">
                  {{ .Team.Name }}
                </div>
              {{ end }}
            {{ else }}
              <p class="text-muted">Esperando equipos...</p>
            {{ end }}
          </div>
        </div>
        {{ if .match }}
          <div class="card mt-4">
            <div class="card-body text-center">
              <h5 class="card-title">Resultado de la Final</h5>
              <p class="card-text">
                <strong>{{ .match.TeamA.Name }}</strong> {{ .match.TeamAGoals }} - {{ .match.TeamBGoals }} <strong>{{ .match.TeamB.Name }}</strong>
              </p>
              {{ if .winnerName }}
                <p>üèÜ Ganador: <strong>{{ .winnerName }}</strong></p>
              {{ end }}
            </div>
          </div>
        {{ end }}
      {{ else if eq .tournament.TeamAmount 4 }}
        <div class="container mt-4">
          <h4 class="text-center mb-3">Tabla de Posiciones</h4>
          {{ if not .standings }}
            <p class="text-center text-muted">A√∫n no hay partidos jugados</p>
          {{ else }}
            <table class="table table-bordered table-hover align-middle">
              <thead class="table-primary text-center">
                <tr>
                  <th scope="col">Pos</th>
                  <th scope="col">Equipo</th>
                  <th scope="col">PJ</th>
                  <th scope="col">G</th>
                  <th scope="col">P</th>
                  <th scope="col">GF</th>
                  <th scope="col">GC</th>
                  <th scope="col">DG</th>
                  <th scope="col">Pts</th>
                </tr>
              </thead>
              <tbody class="text-center">
                {{ range $i, $s := .standings }}
                  <tr>
                    <td>{{ add $i 1 }}</td>
                    <td class="text-start">
                      <img src="{{ $s.BadgeURL }}" alt="Escudo" style="width:35px;height:35px;border-radius:5px;margin-right:8px;">
                      {{ $s.TeamName }}
                    </td>
                    <td>{{ add $s.Wins $s.Losses }}</td>
                    <td>{{ $s.Wins }}</td>
                    <td>{{ $s.Losses }}</td>
                    <td>{{ $s.GoalsFor }}</td>
                    <td>{{ $s.GoalsAgainst }}</td>
                    <td>{{ $s.GoalDifference }}</td>
                    <td><strong>{{ $s.Points }}</strong></td>
                  </tr>
                {{ end }}
              </tbody>
            </table>
          {{ end }}
          <!-- Partidos del torneo -->
          <div class="container mt-5">
            <h4 class="text-center mb-3">üìÖ Partidos Jugados</h4>

            {{ if not .matches }}
              <p class="text-center text-muted">Todav√≠a no hay partidos finalizados.</p>
            {{ else }}
              <table class="table table-striped text-center align-middle">
                <thead class="table-dark">
                  <tr>
                    <th>Fecha</th>
                    <th>Equipo A</th>
                    <th>Resultado</th>
                    <th>Equipo B</th>
                    <th>Ganador</th>
                  </tr>
                </thead>
                <tbody>
                  {{ range .matches }}
                    <tr>
                      <td>{{ .Date.Format "02/01/2006" }}</td>
                      <td>{{ .TeamA.Name }}</td>
                      <td>{{ .TeamAGoals }} - {{ .TeamBGoals }}</td>
                      <td>{{ .TeamB.Name }}</td>
                      <td>
                        {{ if gt .TeamAGoals .TeamBGoals }}
                          {{ .TeamA.Name }}
                        {{ else }}
                          {{ .TeamB.Name }}
                        {{ end }}
                      </td>
                    </tr>
                  {{ end }}
                </tbody>
              </table>
            {{ end }}
          </div>
        </div>
      {{ end }}
      {{ if and (eq .tournament.TeamAmount 4) (not .tournament.Winner.Name) .isAdmin }}
        <div class="text-center mt-4">
          <form method="POST" action="/tournaments/{{ .tournament.ID }}/finish">
            <button class="btn btn-success">Finalizar Torneo</button>
          </form>
        </div>
      {{ end }}
    </div>

    <!-- Botones -->
<div class="text-center mt-4">

  {{ if .isFull }}
    <!-- Torneo lleno -->
    <div class="alert alert-secondary" role="alert">
      üèÜ Torneo completo, no se admiten m√°s inscripciones.
    </div>

  {{ else if .isRegistered }}
    <!-- Usuario ya inscripto -->
    <div class="alert alert-info" role="alert">
      ‚úÖ Ya est√°s inscripto a este torneo.
    </div>

  {{ else if .IsLoggedIn }}
    <!-- Usuario logueado, puede inscribirse -->
    <form method="POST" action="/tournaments/{{ .tournament.ID }}/join">
      <button class="btn btn-primary">Inscribirse al Torneo</button>
    </form>

  {{ else }}
    <!-- Usuario no autenticado -->
    <div class="alert alert-warning" role="alert">
      üîí Inici√° sesi√≥n para inscribirte al torneo.
    </div>
  {{ end }}
</div>
  </div>
  <footer class="mt-auto py-3 text-center">
    <div class="container">
      <span>¬© 2025 <strong>FantasyFUT League</strong> ‚Äî Proyecto acad√©mico desarrollado en Go ‚öΩ</span>
    </div>
  </footer>
</body>
</html>